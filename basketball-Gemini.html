<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Basketball Stat Tracker</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for icons (still included, though not directly used for edit icon now, but good to keep for general use) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!--
        PWA-specific links (manifest, icons, theme-color) are commented out
        for direct HTML running. Uncomment when deploying as a PWA.
    -->
    <!-- <link rel="manifest" href="/manifest.json"> -->
    <!-- <link rel="icon" href="https://placehold.co/192x192/000/FFF?text=BB" sizes="192x192" type="image/png"> -->
    <!-- <link rel="apple-touch-icon" href="https://placehold.co/180x180/000/FFF?text=BB"> -->
    <!-- <meta name="theme-color" content="#1a202c"/> -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            /* Added background image for the body */
            background-image: url('https://placehold.co/1200x800/FFA500/FFF?text=Cartoonish+Court+and+Fireball'); /* Placeholder image */
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed; /* Ensures background stays fixed during scroll */
            background-color: #f0f2f5; /* Fallback color */
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Align to top */
            min-height: 100vh;
            padding: 0.25rem; /* Even further reduced overall padding */
        }
        .container {
            max-width: 600px;
            width: 100%;
            background-color: #ffffff;
            border-radius: 1.25rem; /* Slightly smaller border-radius */
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1); /* Slightly smaller shadow */
            padding: 0.75rem; /* Further reduced container padding */
        }
        .btn-stat, .btn-score, .btn-action {
            padding: 0.6rem 0.4rem; /* Reduced default padding for all buttons */
            font-weight: bold;
            border-radius: 0.6rem; /* Slightly less rounded for compactness */
            transition: transform 0.1s ease-in-out, background-color 0.1s ease-in-out;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* Even smaller shadow */
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            text-align: center;
            line-height: 1.1; /* Reduced line height for more compactness */
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        .btn-stat:active, .btn-score:active, .btn-action:active {
            transform: scale(0.98);
        }
        .stat-active {
            background-color: #4f46e5;
            color: white;
            box-shadow: 0 3px 6px rgba(79, 70, 229, 0.3);
        }
        .stat-inactive {
            background-color: #e0e7ff;
            color: #4f46e5;
        }

        /* Player Button Styling */
        .btn-player { /* This is now the main player button style */
            position: relative;
            width: 100%; /* Ensures it takes full width of its grid column */
            background-color: #e0e7ff; /* Default background for players */
            color: #4f46e5; /* Default text color */
            padding: 0.7rem 0.5rem; /* Optimized padding for mobile tap */
            font-weight: bold;
            border-radius: 0.6rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: transform 0.1s ease-in-out, background-color 0.1s ease-in-out, border 0.1s ease-in-out, box-shadow 0.1s ease-in-out;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            line-height: 1.1;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            cursor: pointer;
            border: 2px solid transparent; /* Default transparent border */
        }
        .btn-player:hover {
             background-color: #c7d2fe; /* Light hover effect */
        }
        .player-active { /* Style for the actively selected player button */
            background-color: #bfdbfe; /* Lighter blue for active player */
            border: 2px solid #2563eb; /* Blue border */
            box-shadow: 0 4px 8px rgba(37, 99, 235, 0.3);
        }
        .player-button-locked {
            background-color: #d1d5db;
            cursor: not-allowed;
        }
        .player-button-locked .player-name, .player-button-locked .player-stats span {
            color: #6b7280; /* Darker text for locked state */
        }

        /* Responsive adjustments for smaller screens (further condensation) */
        @media (max-width: 480px) {
            /* Stat buttons and main action buttons */
            .btn-stat, .btn-action {
                font-size: 0.7rem;
                padding: 0.6rem 0.4rem;
            }
            .btn-stat span {
                font-size: 1.5rem;
            }

            /* Scoreboard adjustments to be similar to top buttons, and parallel */
            .scoreboard-container {
                display: flex;
                flex-direction: row;
                align-items: center;
                justify-content: space-around;
                background-color: #3b82f6;
                color: white;
                padding: 0.6rem;
                border-radius: 0.6rem;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                width: 100%;
            }
            #my-team-score-wrapper, #rival-team-score-wrapper {
                display: flex;
                flex-direction: column;
                align-items: center;
                flex-grow: 1;
                padding: 0.2rem;
            }
            /* Increased my team score font for better visibility */
            #my-team-score {
                font-size: 2.2rem; /* Increased from 1.8rem */
            }
            #rival-points-btn {
                padding: 0;
                background: none;
                color: inherit;
                box-shadow: none;
                /* Ensured rival score matches my team score font size */
                font-size: 2.2rem; /* Adjusted to match my-team-score */
                font-weight: extrabold;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            #rival-points-btn span {
                /* Ensured rival score matches my team score font size */
                font-size: 2.2rem; /* Adjusted to match my-team-score */
                margin-left: 0.25rem;
                line-height: 1.0;
            }
            .scoreboard-vs {
                font-size: 1.2rem;
                margin: 0 0.5rem;
                font-weight: normal;
                opacity: 0.8;
            }
            .scoreboard-title { /* For 'My Team' / 'Rival Team' text */
                font-size: 0.6rem; /* Decreased rival team title font size */
                font-weight: normal;
                opacity: 0.9;
                margin-bottom: 0.1rem;
            }

            /* Player button internal content styling */
            .player-name {
                font-size: 0.7rem; /* Adjusted for better readability */
            }
            .player-stats span {
                font-size: 0.65rem; /* Adjusted for better readability */
            }
            .player-stats {
                margin-top: 0.05rem;
            }

            /* General text size adjustments */
            .text-3xl { font-size: 1.5rem; }
            .text-sm { font-size: 0.65rem; }
            .text-lg { font-size: 0.8rem; }
        }

        /* Modal styling */
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.6);
        }
        .modal-content {
            background-color: white;
            border-radius: 0.75rem;
            padding: 1rem;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 350px;
        }
        /* Report Modal Specifics */
        #report-output {
            white-space: pre-wrap; /* Preserves whitespace and wraps text */
            word-wrap: break-word; /* Breaks long words */
            height: 200px; /* Fixed height for readability */
            overflow-y: auto; /* Scroll if content exceeds height */
            border: 1px solid #e2e8f0;
            background-color: #f8fafc;
            padding: 0.75rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            line-height: 1.4;
            color: #334155;
            resize: vertical; /* Allow vertical resizing */
        }
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-50 to-purple-50">
    <div class="container mx-auto p-6 bg-white rounded-3xl shadow-xl mt-8">
        <h1 class="text-3xl font-extrabold text-center text-gray-900 mb-6">Basketball Game Tracker</h1>
        <p class="text-center text-gray-600 mb-6 text-sm">Data stored locally in your browser.</p>

        <!-- Stat Buttons -->
        <div id="stat-buttons" class="grid grid-cols-2 sm:grid-cols-4 gap-2 mb-4">
            <button id="shots-btn" class="btn-stat stat-active bg-indigo-600 text-white hover:bg-indigo-700">
                <span class="text-xl sm:text-2xl font-extrabold">üèÄ</span> Shots
            </button>
            <button id="rebounds-btn" class="btn-stat stat-inactive bg-indigo-100 text-indigo-700 hover:bg-indigo-200">
                <span class="text-xl sm:text-2xl font-extrabold">üí™</span> Rebounds
            </button>
            <button id="assists-btn" class="btn-stat stat-inactive bg-indigo-100 text-indigo-700 hover:bg-indigo-200">
                <span class="text-xl sm:text-2xl font-extrabold">ü§ù</span> Assists
            </button>
            <button id="points-btn" class="btn-stat stat-inactive bg-indigo-100 text-indigo-700 hover:bg-indigo-200">
                <span class="text-xl sm:text-2xl font-extrabold">üî•</span> Points
            </button>
        </div>

        <!-- Scoreboard -->
        <div class="scoreboard-container bg-gradient-to-r from-blue-700 to-indigo-800 text-white shadow-lg mb-4">
            <div id="my-team-score-wrapper">
                <h2 class="scoreboard-title">My Team</h2>
                <span id="my-team-score" class="font-extrabold text-yellow-300 drop-shadow-lg">0</span>
            </div>
            <div class="scoreboard-vs font-bold text-gray-300">vs</div>
            <div id="rival-team-score-wrapper">
                <button id="rival-points-btn" class="btn-score">
                    <span class="scoreboard-title">Rival Points</span> <span id="rival-team-score">0</span>
                </button>
            </div>
        </div>

        <!-- Players Section -->
        <div id="players-grid" class="grid grid-cols-2 gap-2">
            <!-- Player buttons will be dynamically inserted here by JavaScript -->
        </div>

        <!-- Action Buttons -->
        <div class="flex justify-center mt-4 space-x-2">
            <button id="reset-game-btn" class="btn-action bg-yellow-500 text-white hover:bg-yellow-600 px-4 py-1.5 text-md">Reset Game</button>
            <button id="edit-all-players-btn" class="btn-action bg-blue-500 text-white hover:bg-blue-600 px-4 py-1.5 text-md">Edit Players</button>
            <button id="generate-report-btn" class="btn-action bg-green-500 text-white hover:bg-green-600 px-4 py-1.5 text-md">Generate Report</button>
        </div>
    </div>

    <!-- Global Edit Players Modal -->
    <div id="edit-all-players-modal" class="fixed inset-0 modal-overlay flex items-center justify-center p-4 z-50 hidden">
        <div class="modal-content transform transition-all duration-300 scale-95 opacity-0 max-h-[90vh] overflow-y-auto">
            <h3 class="text-xl font-bold mb-3 text-gray-800">Edit All Players</h3>
            <div id="all-players-edit-list" class="space-y-3 mb-4">
                <!-- Player edit fields will be dynamically inserted here -->
            </div>
            <div class="flex justify-end space-x-2">
                <button id="save-all-players-btn" class="px-4 py-1.5 rounded-md bg-indigo-600 text-white hover:bg-indigo-700 font-semibold text-sm">Save All</button>
                <button id="cancel-all-edit-btn" class="px-4 py-1.5 rounded-md bg-red-500 text-white hover:bg-red-600 font-semibold text-sm">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Report Modal -->
    <div id="report-modal" class="fixed inset-0 modal-overlay flex items-center justify-center p-4 z-50 hidden">
        <div class="modal-content transform transition-all duration-300 scale-95 opacity-0">
            <h3 class="text-xl font-bold mb-3 text-gray-800">Game Report</h3>
            <div id="report-output" contenteditable="true" class="w-full h-48 mb-4"></div>
            <div class="flex justify-end space-x-2">
                <button id="copy-report-btn" class="px-4 py-1.5 rounded-md bg-blue-600 text-white hover:bg-blue-700 font-semibold text-sm">Copy to Clipboard</button>
                <button id="close-report-btn" class="px-4 py-1.5 rounded-md bg-gray-300 text-gray-800 hover:bg-gray-400 font-semibold text-sm">Close</button>
            </div>
        </div>
    </div>


    <!-- Message Box (for alerts, confirmations) -->
    <div id="message-box-modal" class="fixed inset-0 modal-overlay flex items-center justify-center p-4 z-50 hidden">
        <div class="modal-content transform transition-all duration-300 scale-95 opacity-0">
            <h3 id="message-box-title" class="text-xl font-bold mb-3 text-gray-800"></h3>
            <p id="message-box-message" class="text-gray-700 mb-5 text-sm"></p>
            <div class="flex justify-end space-x-2">
                <button id="message-box-confirm-btn" class="px-4 py-1.5 rounded-md bg-indigo-600 text-white hover:bg-indigo-700 font-semibold hidden text-sm">Confirm</button>
                <button id="message-box-cancel-btn" class="px-4 py-1.5 rounded-md bg-gray-300 text-gray-800 hover:bg-gray-400 font-semibold hidden text-sm">Cancel</button>
                <button id="message-box-ok-btn" class="px-4 py-1.5 rounded-md bg-indigo-600 text-white hover:bg-indigo-700 font-semibold hidden text-sm">OK</button>
            </div>
        </div>
    </div>


    <script type="module">
        // --- Game State Variables ---
        let myTeamScore = 0;
        let rivalTeamScore = 0;
        const STAT_TYPES = ['shots', 'rebounds', 'assists', 'points'];
        let activeStat = 'shots'; // Default active stat
        let players = []; // Array to hold player objects
        let activePlayerId = null; // New variable to track the currently selected player

        // --- Message Box Utility ---
        const messageBoxModal = document.getElementById('message-box-modal');
        const messageBoxTitle = document.getElementById('message-box-title');
        const messageBoxMessage = document.getElementById('message-box-message');
        const messageBoxConfirmBtn = document.getElementById('message-box-confirm-btn');
        const messageBoxCancelBtn = document.getElementById('message-box-cancel-btn');
        const messageBoxOkBtn = document.getElementById('message-box-ok-btn');

        function showMessageBox(title, message, type = 'alert', onConfirm = null, onCancel = null) {
            messageBoxTitle.textContent = title;
            messageBoxMessage.textContent = message;

            messageBoxConfirmBtn.classList.add('hidden');
            messageBoxCancelBtn.classList.add('hidden');
            messageBoxOkBtn.classList.add('hidden');

            // Remove previous event listeners
            messageBoxConfirmBtn.onclick = null;
            messageBoxCancelBtn.onclick = null;
            messageBoxOkBtn.onclick = null;

            if (type === 'confirm') {
                messageBoxConfirmBtn.classList.remove('hidden');
                messageBoxCancelBtn.classList.remove('hidden');
                messageBoxConfirmBtn.onclick = () => {
                    messageBoxModal.classList.add('hidden');
                    if (onConfirm) onConfirm();
                    // Animate out
                    messageBoxModal.querySelector('.modal-content').classList.remove('scale-100', 'opacity-100');
                    messageBoxModal.querySelector('.modal-content').classList.add('scale-95', 'opacity-0');
                };
                messageBoxCancelBtn.onclick = () => {
                    messageBoxModal.classList.add('hidden');
                    if (onCancel) onCancel();
                    // Animate out
                    messageBoxModal.querySelector('.modal-content').classList.remove('scale-100', 'opacity-100');
                    messageBoxModal.querySelector('.modal-content').classList.add('scale-95', 'opacity-0');
                };
            } else { // 'alert'
                messageBoxOkBtn.classList.remove('hidden');
                messageBoxOkBtn.onclick = () => {
                    messageBoxModal.classList.add('hidden');
                     // Animate out
                    messageBoxModal.querySelector('.modal-content').classList.remove('scale-100', 'opacity-100');
                    messageBoxModal.querySelector('.modal-content').classList.add('scale-95', 'opacity-0');
                };
            }
            messageBoxModal.classList.remove('hidden');
            // Animate in
            setTimeout(() => {
                messageBoxModal.querySelector('.modal-content').classList.remove('scale-95', 'opacity-0');
                messageBoxModal.querySelector('.modal-content').classList.add('scale-100', 'opacity-100');
            }, 50);
        }

        // --- Game State Management (Local) ---
        function initialSetup() {
            // Initialize players if they don't exist
            if (players.length === 0) {
                for (let i = 1; i <= 10; i++) {
                    players.push({
                        id: `player${i}`,
                        name: `Player ${i}`,
                        locked: false,
                        stats: { shots: 0, rebounds: 0, assists: 0, points: 0 }
                    });
                }
            }
            updateUI();
        }

        function updateUI() {
            document.getElementById('my-team-score').textContent = myTeamScore;
            document.getElementById('rival-team-score').textContent = rivalTeamScore;

            // Update stat buttons styling
            STAT_TYPES.forEach(stat => {
                const button = document.getElementById(`${stat}-btn`);
                if (button) {
                    if (stat === activeStat) {
                        button.classList.add('stat-active');
                        button.classList.remove('stat-inactive');
                        button.classList.remove('bg-indigo-100', 'text-indigo-700', 'hover:bg-indigo-200');
                        button.classList.add('bg-indigo-600', 'text-white', 'hover:bg-indigo-700');
                    } else {
                        button.classList.remove('stat-active');
                        button.classList.add('stat-inactive');
                        button.classList.remove('bg-indigo-600', 'text-white', 'hover:bg-indigo-700');
                        button.classList.add('bg-indigo-100', 'text-indigo-700', 'hover:bg-indigo-200');
                    }
                }
            });

            // Render player buttons
            const playersGrid = document.getElementById('players-grid');
            playersGrid.innerHTML = ''; // Clear existing buttons

            players.forEach(player => {
                const playerButton = document.createElement('button'); // Changed from wrapper back to button directly
                playerButton.id = `player-btn-${player.id}`;
                playerButton.className = `btn-player w-full`; // Use btn-player directly and ensure full width
                if (player.locked) {
                    playerButton.classList.add('player-button-locked');
                }
                if (player.id === activePlayerId) {
                    playerButton.classList.add('player-active');
                }

                playerButton.innerHTML = `
                    <span class="player-name text-sm font-semibold">${player.name}</span>
                    <div class="player-stats text-xs text-gray-600 mt-0.5">
                        <span class="shots-stat">S: ${player.stats.shots}</span> |
                        <span class="rebounds-stat">R: ${player.stats.rebounds}</span> |
                        <span class="assists-stat">A: ${player.stats.assists}</span> |
                        <span class="points-stat">P: ${player.stats.points}</span>
                    </div>
                `;

                // Add event listener for stat increment (quick tap)
                playerButton.addEventListener('click', () => {
                    activePlayerId = player.id; // Set as active player on click
                    incrementPlayerStat(player.id);
                });

                playersGrid.appendChild(playerButton);
            });
        }

        function changeStatMode(mode) {
            activeStat = mode;
            saveGameData(); // Save active stat change
            updateUI();
        }

        function incrementPlayerStat(playerId) {
            const playerIndex = players.findIndex(p => p.id === playerId);
            if (playerIndex !== -1) {
                if (players[playerIndex].locked) {
                    showMessageBox('Locked Player', 'This player is locked and cannot be edited or have stats incremented.', 'alert');
                    return;
                }
                console.log(`Incrementing ${activeStat} for player ${players[playerIndex].name}. Before: ${players[playerIndex].stats[activeStat]}`);
                players[playerIndex].stats[activeStat]++; // Increment by 1 for all stats initially
                if (activeStat === 'points') {
                    myTeamScore += 2; // Increment points by 2
                }
                console.log(`After: ${players[playerIndex].stats[activeStat]}. My Team Score: ${myTeamScore}`);
                saveGameData(); // Save data to Local Storage
                updateUI();
            } else {
                console.error(`Player with ID ${playerId} not found.`);
            }
        }

        function incrementRivalPoints() {
            rivalTeamScore += 2; // Increment rival points by 2
            saveGameData(); // Save data to Local Storage
            updateUI();
        }

        // --- Local Storage Operations ---
        const LOCAL_STORAGE_KEY = 'basketballGameData';

        function saveGameData() {
            const dataToSave = {
                myTeamScore: myTeamScore,
                rivalTeamScore: rivalTeamScore,
                players: players.map(player => ({
                    ...player,
                    stats: { ...player.stats } // Deep copy stats object
                })),
                activeStat: activeStat, // Save active stat
                activePlayerId: activePlayerId // Save active player
            };
            try {
                localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(dataToSave));
                console.log("Game data saved to Local Storage!");
            } catch (e) {
                console.error("Error saving game data to Local Storage: ", e);
                showMessageBox('Save Error', `Failed to save game data locally: ${e.message}`, 'alert');
            }
        }

        function loadGameData() {
            try {
                const savedData = localStorage.getItem(LOCAL_STORAGE_KEY);
                if (savedData) {
                    const data = JSON.parse(savedData);
                    myTeamScore = data.myTeamScore || 0;
                    rivalTeamScore = data.rivalTeamScore || 0;
                    players = data.players || [];
                    activeStat = data.activeStat || 'shots'; // Load active stat, default to 'shots'
                    activePlayerId = data.activePlayerId || null; // Load active player
                    console.log("Game data loaded from Local Storage:", data);
                    initialSetup(); // Re-render UI with loaded data
                } else {
                    console.log("No existing game data found in Local Storage. Initializing new game.");
                    initialSetup(); // Initialize default game if no data exists
                    saveGameData(); // Save the initial state
                }
            } catch (e) {
                console.error("Error loading game data from Local Storage: ", e);
                showMessageBox('Load Error', `Failed to load game data locally: ${e.message}`, 'alert');
                initialSetup(); // Fallback to local setup if loading fails
            }
        }

        // --- Global Edit Players Modal Logic ---
        const editAllPlayersModal = document.getElementById('edit-all-players-modal');
        const allPlayersEditList = document.getElementById('all-players-edit-list');
        const saveAllPlayersBtn = document.getElementById('save-all-players-btn');
        const cancelAllEditBtn = document.getElementById('cancel-all-edit-btn');
        const editAllPlayersBtn = document.getElementById('edit-all-players-btn');

        editAllPlayersBtn.addEventListener('click', openEditAllPlayersModal);

        function openEditAllPlayersModal() {
            allPlayersEditList.innerHTML = ''; // Clear previous content

            players.forEach(player => {
                const playerEditDiv = document.createElement('div');
                playerEditDiv.className = 'flex items-center space-x-2 p-2 bg-gray-50 rounded-md';
                playerEditDiv.dataset.playerId = player.id; // Store player ID

                playerEditDiv.innerHTML = `
                    <input type="text" value="${player.name}" placeholder="Player Name" class="flex-grow p-1 border border-gray-300 rounded-md text-gray-800 text-sm">
                    <button class="toggle-lock-btn px-2 py-1 rounded-md bg-gray-200 text-gray-700 text-xs font-semibold">
                        ${player.locked ? 'Unlock Name' : 'Lock Name'}
                    </button>
                `;
                allPlayersEditList.appendChild(playerEditDiv);

                // Add event listener for the toggle lock button within this modal
                const toggleLockBtn = playerEditDiv.querySelector('.toggle-lock-btn');
                toggleLockBtn.addEventListener('click', () => {
                    const currentLockedStatus = players.find(p => p.id === player.id).locked;
                    players.find(p => p.id === player.id).locked = !currentLockedStatus;
                    toggleLockBtn.textContent = !currentLockedStatus ? 'Unlock Name' : 'Lock Name';
                });
            });

            editAllPlayersModal.classList.remove('hidden');
            setTimeout(() => {
                editAllPlayersModal.querySelector('.modal-content').classList.remove('scale-95', 'opacity-0');
                editAllPlayersModal.querySelector('.modal-content').classList.add('scale-100', 'opacity-100');
            }, 50);
        }

        saveAllPlayersBtn.addEventListener('click', () => {
            const playerEditDivs = allPlayersEditList.querySelectorAll('[data-player-id]');
            playerEditDivs.forEach(div => {
                const playerId = div.dataset.playerId;
                const newName = div.querySelector('input[type="text"]').value.trim();
                const playerIndex = players.findIndex(p => p.id === playerId);
                if (playerIndex !== -1) {
                    players[playerIndex].name = newName || `Player ${playerIndex + 1}`;
                    // Lock status is already updated by its individual button
                }
            });
            saveGameData();
            updateUI();
            closeEditAllPlayersModal();
        });

        cancelAllEditBtn.addEventListener('click', () => {
            closeEditAllPlayersModal();
        });

        function closeEditAllPlayersModal() {
            editAllPlayersModal.classList.add('hidden');
            editAllPlayersModal.querySelector('.modal-content').classList.remove('scale-100', 'opacity-100');
            editAllPlayersModal.querySelector('.modal-content').classList.add('scale-95', 'opacity-0');
        }


        // --- Report Modal Logic ---
        const reportModal = document.getElementById('report-modal');
        const reportOutput = document.getElementById('report-output');
        const generateReportBtn = document.getElementById('generate-report-btn');
        const copyReportBtn = document.getElementById('copy-report-btn');
        const closeReportBtn = document.getElementById('close-report-btn');

        generateReportBtn.addEventListener('click', () => {
            const reportContent = generateReport();
            reportOutput.textContent = reportContent;
            reportModal.classList.remove('hidden');
            // Animate in
            setTimeout(() => {
                reportModal.querySelector('.modal-content').classList.remove('scale-95', 'opacity-0');
                reportModal.querySelector('.modal-content').classList.add('scale-100', 'opacity-100');
            }, 50);
        });

        copyReportBtn.addEventListener('click', () => {
            if (reportOutput) {
                // For clipboard operations within iframes, document.execCommand('copy') is generally more reliable
                // than navigator.clipboard.writeText() due to security restrictions.
                const range = document.createRange();
                range.selectNodeContents(reportOutput);
                const selection = window.getSelection();
                selection.removeAllRanges();
                selection.addRange(range);
                try {
                    document.execCommand('copy');
                    showMessageBox('Copied!', 'Report copied to clipboard.', 'alert');
                } catch (err) {
                    console.error('Failed to copy text: ', err);
                    showMessageBox('Copy Error', 'Failed to copy report to clipboard. Please try manually selecting and copying the text.', 'alert');
                }
                // Deselect the text
                selection.removeAllRanges();
            }
        });


        closeReportBtn.addEventListener('click', () => {
            reportModal.classList.add('hidden');
            // Animate out
            reportModal.querySelector('.modal-content').classList.remove('scale-100', 'opacity-100');
            reportModal.querySelector('.modal-content').classList.add('scale-95', 'opacity-0');
        });

        function generateReport() {
            let report = `Basketball Game Report\n`;
            report += `-------------------------\n`;
            report += `My Team Score: ${myTeamScore}\n`;
            report += `Rival Team Score: ${rivalTeamScore}\n\n`;
            report += `Player Statistics:\n`;
            players.forEach(player => {
                report += `  ${player.name}${player.locked ? ' (LOCKED)' : ''}:\n`;
                report += `    Shots: ${player.stats.shots}\n`;
                report += `    Rebounds: ${player.stats.rebounds}\n`;
                report += `    Assists: ${player.stats.assists}\n`;
                report += `    Points: ${player.stats.points}\n`;
                report += `\n`;
            });
            report += `-------------------------\n`;
            report += `Generated on: ${new Date().toLocaleString()}\n`;
            return report;
        }


        // --- Event Listeners for Main Buttons ---
        document.getElementById('shots-btn').addEventListener('click', () => changeStatMode('shots'));
        document.getElementById('rebounds-btn').addEventListener('click', () => changeStatMode('rebounds'));
        document.getElementById('assists-btn').addEventListener('click', () => changeStatMode('assists'));
        document.getElementById('points-btn').addEventListener('click', () => changeStatMode('points'));
        document.getElementById('rival-points-btn').addEventListener('click', incrementRivalPoints);

        document.getElementById('reset-game-btn').addEventListener('click', () => {
            showMessageBox(
                'Reset Game',
                'Are you sure you want to reset all scores and player stats?',
                'confirm',
                () => {
                    myTeamScore = 0;
                    rivalTeamScore = 0;
                    players.forEach(player => {
                        STAT_TYPES.forEach(stat => player.stats[stat] = 0);
                    });
                    saveGameData();
                    updateUI();
                    showMessageBox('Game Reset', 'The game has been reset successfully!', 'alert');
                }
            );
        });

        // Load data from local storage on window load
        window.addEventListener('load', loadGameData);
    </script>

    <!--
        Service Worker (sw.js) content is commented out.
        Uncomment and save as `sw.js` when deploying as a PWA.
    -->
    <!--
    <script id="service-worker-content" type="text/plain">
        // sw.js
        const CACHE_NAME = 'basketball-tracker-v1';
        const urlsToCache = [
            '/', // The root path, which is index.html
            '/index.html',
            '/manifest.json',
            'https://cdn.tailwindcss.com',
            // Placeholder icon URL, replace with your actual icon path if you have one
            'https://placehold.co/192x192/000/FFF?text=BB',
            'https://placehold.co/180x180/000/FFF?text=BB',
            // Firebase SDKs - ensure these are correctly cached if needed offline for initial load
            'https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js',
            'https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js',
            'https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js'
        ];

        self.addEventListener('install', (event) => {
            console.log('Service Worker: Install event');
            event.waitUntil(
                caches.open(CACHE_NAME)
                    .then((cache) => {
                        console.log('Service Worker: Caching app shell');
                        return cache.addAll(urlsToCache);
                    })
                    .catch(err => {
                        console.error('Service Worker: Cache.addAll failed', err);
                    })
            );
        });

        self.addEventListener('activate', (event) => {
            console.log('Service Worker: Activate event');
            event.waitUntil(
                caches.keys().then((cacheNames) => {
                    return Promise.all(
                        cacheNames.map((cacheName) => {
                            if (cacheName !== CACHE_NAME) {
                                console.log('Service Worker: Deleting old cache', cacheName);
                                return caches.delete(cacheName);
                            }
                            return null;
                        })
                    );
                })
            );
            return self.clients.claim();
        });

        self.addEventListener('fetch', (event) => {
            // Check if the request is for an external Firebase script or data.
            // Firebase data/auth requests should generally go to network first.
            if (event.request.url.includes('firebasejs') || event.request.url.includes('googleapis.com')) {
                event.respondWith(
                    fetch(event.request).catch(() => {
                        // If network fails for Firebase scripts, try cache (though unlikely to be there for dynamic parts)
                        return caches.match(event.request);
                    })
                );
                return;
            }

            // For other requests (app shell, etc.), try cache first, then network
            event.respondWith(
                caches.match(event.request)
                    .then((response) => {
                        // Cache hit - return response
                        if (response) {
                            console.log('Service Worker: Fetch from cache', event.request.url);
                            return response;
                        }
                        // No cache hit - fetch from network
                        return fetch(event.request)
                            .then((networkResponse) => {
                                // Check if we received a valid response
                                if (!networkResponse || networkResponse.status !== 200 || networkResponse.type !== 'basic') {
                                    return networkResponse;
                                }
                                // IMPORTANT: Clone the response. A response is a stream and
                                // can only be consumed once. We must clone it so that we can
                                // serve the browser and put a copy in the cache.
                                const responseToCache = networkResponse.clone();

                                caches.open(CACHE_NAME)
                                    .then((cache) => {
                                        cache.put(event.request, responseToCache);
                                    });
                                console.log('Service Worker: Fetch from network and cache', event.request.url);
                                return networkResponse;
                            })
                            .catch(() => {
                                // Fallback for network failures (e.g., show offline page)
                                console.log('Service Worker: Network request failed for', event.request.url);
                                // You can return a generic offline page here if the request fails
                                // return caches.match('/offline.html'); // Requires an offline.html
                            });
                    })
            );
        });
    </script>
    -->
</body>
</html>
